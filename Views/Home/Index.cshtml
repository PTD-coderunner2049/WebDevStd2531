@* @model List<WebDevStd2531.Models.Product> *@
@model WebDevStd2531.Models.HomeViewModelIndex
@{
	ViewData["Title"] = "Home Page OwO";
}
<div class="well well-small">
	<h4>Featured Products <small class="pull-right">200+ featured products</small></h4>
	<div class="row-fluid">
		<div id="featured" class="carousel slide">
			<div class="carousel-inner">
				@{  var products = Model.FeaturedProducts.ToList();
					int totalProducts = products.Count;
					int totalSlides = (int)Math.Ceiling((double)totalProducts / 4);
				}
				@for (int slideIndex = 0; slideIndex < totalSlides; slideIndex++)
				{
					// Determine the starting index for the current slide
					int startIndex = slideIndex * 4;
					// 'item active' for the first slide only because my js carousel needs it?? I havent read the js yet
					string itemClass = (slideIndex == 0) ? "item active" : "item";
					<div class="@itemClass">
						<ul class="thumbnails">
							@for (int i = startIndex; i < Math.Min(startIndex + 4, totalProducts); i++)
							{
								var item = products[i];

								<li class="span3">
									<div class="thumbnail">
										<i class="tag"></i>
										<a 
											asp-controller="Prod"
											asp-action="ProdDetail"
											asp-route-id="@item.Id">
											<img src="@item.ImageUrl" alt="@item.Name">
										</a>
										<div class="caption">
											<h5>@item.Name</h5>
											<h4>
												<a class="btn"
												   asp-controller="Prod"
													asp-action="ProdDetail"
													asp-route-id="@item.Id">
													VIEW
												</a>
												<span class="pull-right">$@item.Price.ToString("F2")</span>
											</h4>
										</div>
									</div>
								</li>
							}
						</ul>
					</div>
				}
			</div>
			<a class="left carousel-control" href="#featured" data-slide="prev">‹</a>
			<a class="right carousel-control" href="#featured" data-slide="next">›</a>
		</div>
	</div>
</div>

<h4>Latest Products </h4>
<ul class="thumbnails">
	@{
		var latestSix = Model.FeaturedProducts
		.OrderByDescending(p => p.Id) // Sort by Id to get newer items (assuming higher Id means newer)
		.Take(6); // Take newest 6 items
	}

	@foreach (var item in latestSix)
	{
		// PREREQUISITE: The 'item' product must have its AvailableOptions collection loaded
		
		var defaultType = "Default"; // fallback value
		
		if (item.AvailableOptions != null && item.AvailableOptions.Any())
		{
			// Get the Value property of the first option
			defaultType = item.AvailableOptions.First().Value; 
		}

		// Logic to safely truncate the description to fix card height
		var displayDescription = item.Description;
		if (displayDescription.Length > 50)
		{
			displayDescription = displayDescription.Substring(0, 50) + "...";
		}

		<li class="span3">
			<div class="thumbnail">
				@* Image Link *@
				<a asp-controller="Prod" asp-action="ProdDetail" asp-route-id="@item.Id">
					<img src="@item.ImageUrl" alt="@item.Name">
				</a>

				<div class="caption">
					<h5>@item.Name</h5>

					@* FIX: Truncate the description to fix card height *@
					<p>@displayDescription</p>

					@* Action Buttons and Price *@
					<h4 style="text-align:center">
						@* View Details Button *@
						<a class="btn"
						   asp-controller="Prod"
						   asp-action="ProdDetail"
						   asp-route-id="@item.Id">
							<i class="icon-zoom-in"></i>
						</a>

						@* Add to Cart Button*@
						@* <form asp-controller="Prod" asp-action="AddCartSingle" method="post" style="display:inline;">
							<input type="hidden" name="id" value="@item.Id" />
							<button type="submit" class="btn">
								Add to <i class="icon-shopping-cart"></i>
							</button>
						</form> *@
						<form asp-controller="Cart" asp-action="AddCartItem" method="post" style="display:inline;">
							<input type="hidden" name="ProductId" value="@item.Id" />
							<input type="hidden" name="Quantity" value="1" />
							<input type="hidden" name="SelectedType" value="@defaultType" />

							<button type="submit" class="btn">
								Add to <i class="icon-shopping-cart"></i>
							</button>
						</form>
						@* Price *@
						<a class="btn btn-primary">$@item.Price.ToString("N2")</a>
					</h4>
				</div>
			</div>
		</li>
	}
</ul>